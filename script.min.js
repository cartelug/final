document.addEventListener("DOMContentLoaded", () => {
    // --- GENERAL SITE LOGIC ---
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mainNav = document.getElementById("main-nav");
    if (mobileMenuButton && mainNav) {
        mobileMenuButton.addEventListener("click", () => {
            mainNav.classList.toggle("active");
        });
    }

    const yearSpan = document.getElementById("year");
    if (yearSpan) {
        yearSpan.textContent = new Date().getFullYear();
    }
    
    // --- ORDER PAGE REDESIGN LOGIC ---
    const orderPageBody = document.querySelector('.aurora-body');
    if (orderPageBody) { // Only run this if we are on an order page
        
        // Phase 1: Welcome Pop-up Logic
        const popupOverlay = document.getElementById('feature-popup-overlay');
        const closePopupButton = document.getElementById('popup-close-btn');

        // Show pop-up on page load
        if (popupOverlay) {
            // A small delay to let the page render first
            setTimeout(() => {
                popupOverlay.classList.add('active');
            }, 500);
        }

        // Close pop-up
        if (closePopupButton) {
            closePopupButton.addEventListener('click', () => {
                popupOverlay.classList.remove('active');
            });
        }
        
        // Phase 2 & 3: Checkout Form Logic
        const orderForm = document.getElementById('checkout-form');
        
        if (orderForm) {
            orderForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const selectedPackageInput = document.querySelector('input[name="package"]:checked');
                const clientName = document.getElementById('clientName').value.trim();
                const clientEmail = document.getElementById('clientEmail').value.trim();
                
                if (!selectedPackageInput) {
                    alert('Please select a plan to continue.');
                    return;
                }
                 if (!clientName || !clientEmail) {
                    alert('Please enter your name and email.');
                    return;
                }

                const selectedLabel = document.querySelector(`label[for=${selectedPackageInput.id}]`);
                const packageName = selectedLabel.querySelector('.duration').textContent;
                const packagePrice = selectedPackageInput.dataset.price + ' UGX';
                
                // Final WhatsApp message format
                const message = `Order for Cartelug:\n\nService: Netflix\nPackage: ${packageName}\nPrice: ${packagePrice}\nName: ${clientName}\nEmail: ${clientEmail}`;
                
                window.location.href = `https://wa.me/256762193386?text=${encodeURIComponent(message)}`;
            });
        }
    }
});
