document.addEventListener("DOMContentLoaded", () => {
    // --- GENERAL SITE LOGIC ---
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mainNav = document.getElementById("main-nav");
    if (mobileMenuButton && mainNav) {
        mobileMenuButton.addEventListener("click", () => {
            mainNav.classList.toggle("active");
        });
    }

    const yearSpan = document.getElementById("year");
    if (yearSpan) {
        yearSpan.textContent = new Date().getFullYear();
    }

    // --- NETFLIX AURORA ORDER PAGE LOGIC ---
    const orderFormContainer = document.getElementById('order-form-container');
    const orderForm = document.getElementById('netflix-order-form-v3');
    const packageOptions = document.querySelectorAll('input[name="package"]');
    
    // Elements to update in the summary
    const summaryPriceEl = document.getElementById('summary-total-price');
    const summaryPackageEl = document.getElementById('summary-selected-package');

    if (orderFormContainer && packageOptions.length > 0) {
        
        packageOptions.forEach(radio => {
            radio.addEventListener('change', () => {
                // Show the form when a package is selected for the first time
                if (!orderFormContainer.classList.contains('active')) {
                    orderFormContainer.classList.add('active');
                    orderFormContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }

                // Update the summary card
                const selectedLabel = document.querySelector(`label[for=${radio.id}]`);
                const duration = selectedLabel.querySelector('.duration').textContent;
                const price = radio.dataset.price;
                
                if(summaryPriceEl) summaryPriceEl.textContent = `${price} UGX`;
                if(summaryPackageEl) summaryPackageEl.textContent = `${duration} Plan`;
            });
        });

        if (orderForm) {
            orderForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const selectedPackageInput = document.querySelector('input[name="package"]:checked');
                const clientName = document.getElementById('clientName').value.trim();
                const paymentMethodInput = document.querySelector('input[name="paymentMethod"]:checked');
                
                if (!selectedPackageInput) {
                    alert('Please select a package duration.');
                    return;
                }
                 if (!clientName) {
                    alert('Please enter your name.');
                    return;
                }
                if (!paymentMethodInput) {
                    alert('Please select a payment method.');
                    return;
                }

                const selectedLabel = document.querySelector(`label[for=${selectedPackageInput.id}]`);
                const packageName = selectedLabel.querySelector('.duration').textContent;
                const packagePrice = selectedPackageInput.dataset.price + ' UGX';
                const paymentMethod = paymentMethodInput.value;
                
                // FINAL, CORRECTED WHATSAPP MESSAGE FORMAT
                const message = `Order for Cartelug:\n\nService: Netflix\nPackage: ${packageName}\nPrice: ${packagePrice}\nName: ${clientName}\nPayment Method: ${paymentMethod}`;
                
                window.location.href = `https://wa.me/256762193386?text=${encodeURIComponent(message)}`;
            });
        }
    }
});
