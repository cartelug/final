document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("mobile-menu-button"),t=document.getElementById("main-nav");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active");const o=e.querySelector("i");t.classList.contains("active")?(o.classList.remove("fa-bars"),o.classList.add("fa-times"),e.setAttribute("aria-label","Close Menu")):(o.classList.remove("fa-times"),o.classList.add("fa-bars"),e.setAttribute("aria-label","Open Menu"))}),t.querySelectorAll("a").forEach(o=>{o.addEventListener("click",()=>{const n=window.location.pathname==="/"||window.location.pathname==="/index.html",i=o.getAttribute("href").startsWith("#");n&&i||t.classList.contains("active")&&(t.classList.remove("active"),e.querySelector("i").classList.remove("fa-times"),e.querySelector("i").classList.add("fa-bars"),e.setAttribute("aria-label","Open Menu"))})}));const o=(e,t)=>{const o=document.getElementById(e),n=document.getElementById(t);if(o&&n){const e=n.querySelector(".modal-close"),t=n.querySelector(".modal-overlay"),i=n.querySelector(".modal-content"),l=()=>n.classList.add("active"),s=()=>n.classList.remove("active");o.addEventListener("click",e=>{e.preventDefault(),l()}),e&&e.addEventListener("click",s),t&&t.addEventListener("click",s),i&&i.addEventListener("click",e=>e.stopPropagation())}},n=(e,t)=>{const o=document.getElementById(e);o&&o.addEventListener("submit",function(e){e.preventDefault();const n=o.querySelector('input[name="package"]:checked'),i=o.querySelector("#clientName"),l=o.querySelector('input[name="paymentMethod"]:checked'),s=o.querySelector("#instaUsername");if(!n)return alert("Please select a package."),void o.querySelector('input[name="package"]')?.focus();if(s&&s.required&&""===s.value.trim())return alert("Please enter your Instagram Username."),void s.focus();if(!i||""===i.value.trim())return alert("Please enter your name."),void(i&&i.focus());if(!l)return alert("Please select a payment method."),void o.querySelector('input[name="paymentMethod"]')?.focus();const a=n.value,c=n.getAttribute("data-price"),r=i?i.value.trim():"N/A",d=l.value,p=s?s.value.trim():null;let u=`Order for Cartelug:\n\n*Service:* ${t}\n`;p&&(u+=`*Instagram Username:* ${p}\n`),u+=`*Package:* ${a}\n`,c&&(u+=`*Price:* ${c}\n`),u+=`*Payment Method:* ${d}\n*Name:* ${r}`,window.location.href=`https://wa.me/256762193386?text=${encodeURIComponent(u)}`})};o("netflix-start-btn","netflix-modal"),o("prime-start-btn","prime-modal"),o("spotify-start-btn","spotify-modal"),n("netflix-order-form","Netflix"),n("prime-order-form","Prime Video"),n("spotify-order-form","Spotify"),n("instagram-boost-form","Instagram Likes Boost");if("undefined"!=typeof Swiper&&document.querySelector(".testimonial-swiper"))try{new Swiper(".testimonial-swiper",{direction:"horizontal",loop:!0,slidesPerView:1,spaceBetween:30,grabCursor:!0,autoHeight:!0,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},a11y:{enabled:!0,prevSlideMessage:"Previous testimonial",nextSlideMessage:"Next testimonial",paginationBulletMessage:"Go to testimonial slide {{index}}"},autoplay:{delay:5e3,disableOnInteraction:!1,pauseOnMouseEnter:!0}})}catch(e){console.error("Swiper initialization failed:",e);const t=document.querySelector(".testimonial-swiper");t&&(t.innerHTML='<p style="text-align: center; color: var(--text-medium);">Testimonials could not be loaded.</p>')}document.querySelectorAll(".issue-card[data-service][data-issue]").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-service"),o=e.getAttribute("data-issue");let n=`Help Request for Cartelug:\n\n*Service:* ${t}\n*Issue:* ${o}\n\nPlease describe the problem in detail:`;window.open(`https://wa.me/256762193386?text=${encodeURIComponent(n)}`,"_blank")})});const i=document.getElementById("payment-issue-escalate-btn"),l=document.getElementById("payment-fix-initial"),s=document.getElementById("payment-issue-apology");i&&l&&s&&i.addEventListener("click",()=>{l.style.display="none",s.classList.remove("hidden"),s.style.display="block"});const a=document.getElementById("year");a&&(a.textContent=(new Date).getFullYear());const c=document.querySelector(".renewal-section-v2");if(c){console.log("Renewal V2/V3 Script Initializing...");const e=c.querySelectorAll(".service-card-v2"),t=c.querySelector("#duration-block-v2"),o=c.querySelector("#duration-options-container-v2"),n=t?.querySelector(".dynamic-service-label"),i=c.querySelector("#summary-card-v2"),l=i?.querySelector("#summary-service-v2"),s=i?.querySelector("#summary-duration-v2"),a=i?.querySelector("#summary-price-v2"),r=i?.querySelector("#whatsapp-confirm-btn-v2"),d=i?.querySelector("#reset-renewal-btn-v2"),p=c.querySelectorAll(".copy-btn-v2"),u={Netflix:[{duration:"2 Months",price:"50,000 UGX"},{duration:"3 Months",price:"75,000 UGX"},{duration:"6 Months",price:"150,000 UGX"}],"Prime Video":[{duration:"2 Months",price:"50,000 UGX"},{duration:"3 Months",price:"75,000 UGX"}],Spotify:[{duration:"6 Months",price:"70,000 UGX"},{duration:"1 Year",price:"120,000 UGX"}]};let m=null,h=null,g=null;const y=()=>{l&&s&&a&&r?(console.log("Updating Summary:",{service:m,duration:h,price:g}),l.textContent=m||"Please select",s.textContent=h||"Please select",a.textContent=g||"--",r.disabled=!(m&&h&&g),console.log("WhatsApp button disabled:",!(m&&h&&g))):console.error("One or more summary elements not found!")},f=()=>{console.log("Resetting selections..."),m=null,h=null,g=null,e.forEach(e=>e.classList.remove("selected")),t&&(t.style.display="none"),o&&(o.innerHTML=""),n&&(n.textContent=""),y()};e.forEach(e=>{e.addEventListener("click",()=>{const i=e.getAttribute("data-service");console.log("Service selected:",i),m=i,h=null,g=null,e.forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),((e)=>{console.log("Populating durations for:",e),o&&u[e]?(o.innerHTML="",u[e].length>0?(u[e].forEach((t,n)=>{const i=document.createElement("div");i.className="duration-option-v2";const l=`duration-v2-${e.replace(/\s+/g,"-")}-${n}`;i.innerHTML=`\n                        <input type="radio" id="${l}" name="renewal_duration_v2" value="${t.duration}" data-price="${t.price}">\n                        <label for="${l}">\n                            <span class="duration-text">${t.duration}</span>\n                            <span class="price-text">${t.price}</span>\n                        </label>\n                    `,o.appendChild(i)}),console.log(`Found ${o.querySelectorAll('input[name="renewal_duration_v2"]').length} duration radios to add listeners to.`),o.querySelectorAll('input[name="renewal_duration_v2"]').forEach(e=>{e.addEventListener("change",()=>{console.log("Duration changed:",e.value,e.checked),e.checked&&(h=e.value,g=e.getAttribute("data-price"),y())})}),n&&(n.textContent=`for ${e}`),t&&(console.log("Showing duration block"),t.style.display="block")):(console.log("No durations found for",e),o.innerHTML='<p class="loading-text-v2">No durations found for this service.</p>',t&&(t.style.display="none"))):(console.error("Duration container or price data missing for",e),o&&(o.innerHTML='<p class="loading-text-v2">Options not available.</p>'),t&&(t.style.display="none"))})(m),y(),t&&"none"!==t.style.display&&(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},100)})}),r?(r.addEventListener("click",()=>{console.log("WhatsApp button clicked. State:",{service:m,duration:h,price:g}),m&&h&&g?window.location.href=`https://wa.me/256762193386?text=${encodeURIComponent(`Hi Cartelug, I've paid ${g} to renew my subscription for ${h}. Please confirm my renewal.`)}`:(console.error("WhatsApp button clicked with incomplete selections."),alert("Please complete your service and duration selection first."))}),console.error("WhatsApp confirmation button (#whatsapp-confirm-btn-v2) not found!")):console.error("WhatsApp confirmation button (#whatsapp-confirm-btn-v2) not found!"),d?d.addEventListener("click",f):console.error("Reset button (#reset-renewal-btn-v2) not found!"),"undefined"!=typeof ClipboardJS&&p.length>0?(console.log("Initializing ClipboardJS..."),new ClipboardJS(".copy-btn-v2").on("success",function(e){console.log("Text copied successfully:",e.text);const t=e.trigger.innerHTML;e.trigger.innerHTML='<i class="fas fa-check"></i> Copied',e.trigger.disabled=!0,setTimeout(()=>{e.trigger.innerHTML=t,e.trigger.disabled=!1},1500),e.clearSelection()}).on("error",function(e){console.error("ClipboardJS error:",e.action,e.trigger);const t=e.trigger.closest(".number-copy-wrapper-v2")?.querySelector("strong")?.textContent;alert(`Failed to copy automatically. Please copy manually${t?": "+t:"."}`)  })  ):p.length>0?(console.warn("ClipboardJS library not loaded or no copy buttons found. Hiding copy buttons."),p.forEach(e=>e.style.display="none")):console.log("No copy buttons found on this page."),f()}const r=document.getElementById("netflix-signed-out-help-btn"),d=document.getElementById("signed-out-modal");if(r&&d){const e=d.querySelectorAll(".modal-close, .modal-close-final"),t=d.querySelector(".modal-overlay"),o=d.querySelector(".signed-out-modal-content"),n=d.querySelectorAll(".modal-step"),i=d.querySelector("#modal-step-1"),l=d.querySelector("#modal-step-2"),s=d.querySelector("#modal-step-3"),a=d.querySelector("#modal-step-4-tv"),c=d.querySelector("#modal-step-4-phone"),p=i.querySelector(".email-options-container"),u=i.querySelector("#modal-step1-next"),m=l.querySelector("#modal-selected-email"),h=l.querySelector("#modal-confirm-yes"),g=l.querySelector("#modal-confirm-no"),y=s.querySelector("#modal-select-tv"),f=s.querySelector("#modal-select-phone"),v=a.querySelector("#tv-instruction-email"),q=c.querySelector("#phone-instruction-email"),b=d.querySelectorAll(".modal-back-button");let k=null;const w=["carteluganda0@gmail.com","carteluganda1@gmail.com","carteluganda2@gmail.com","carteluganda3@gmail.com","carteluganda4@gmail.com","carteluganda5@gmail.com","carteluganda6@gmail.com","carteluganda7@gmail.com","carteluganda8@gmail.com","carteluganda9@gmail.com","carteluganda10@gmail.com","carteluganda11@gmail.com","carteluganda12@gmail.com","carteluganda13@gmail.com","carteluganda14@gmail.com","carteluganda15@gmail.com","carteluganda16@gmail.com"],E=()=>{S(),d.classList.add("active")},L=()=>{d.classList.remove("active"),setTimeout(S,300)},C=e=>{n.forEach(e=>e.style.display="none");const t=d.querySelector(`#modal-step-${e}`);t?t.style.display="block":console.error(`Modal step #modal-step-${e} not found!`)},S=()=>{k=null,p&&(p.querySelectorAll('input[type="radio"]').forEach(e=>e.checked=!1)),u&&(u.disabled=!0),C("1")},x=()=>{if(!p)return;p.innerHTML="",w.forEach((e,t)=>{const o=document.createElement("div");o.className="email-option";const n=`email-option-${t}`,i=e.replace(/(\d+)/,"<b>$1</b>");o.innerHTML=`\n                    <input type="radio" id="${n}" name="netflix_email" value="${e}">\n                    <label for="${n}">${i}</label>\n                `,p.appendChild(o),o.querySelector('input[type="radio"]').addEventListener("change",t=>{t.target.checked&&(k=t.target.value,u&&(u.disabled=!1))})})};r.addEventListener("click",E),e.forEach(e=>e.addEventListener("click",L)),t&&t.addEventListener("click",L),o&&o.addEventListener("click",e=>e.stopPropagation()),u&&u.addEventListener("click",()=>{k&&m&&(m.innerHTML=k.replace(/(\d+)/,"<b>$1</b>"),C("2"))}),h&&h.addEventListener("click",()=>C("3")),g&&g.addEventListener("click",()=>C("1")),y&&y.addEventListener("click",()=>{v&&k&&(v.textContent=k),C("4-tv")}),f&&f.addEventListener("click",()=>{q&&k&&(q.textContent=k),C("4-phone")}),b.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-target-step");t&&C(t)})}),x()}}),window.addEventListener("load",()=>{const e=document.getElementById("preloader");e&&setTimeout(()=>{try{console.log("Window loaded. Attempting to hide preloader."),setTimeout(()=>{e.classList.add("hidden"),console.log("Applied 'hidden' class to preloader.")},50)}catch(t){console.error("Error hiding preloader:",t),e.style.display="none"}},50)});
